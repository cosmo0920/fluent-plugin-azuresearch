{
  "name": "fluent-plugin-azuresearch",
  "tagline": "Azure Search Output Plugin for Fluentd",
  "body": "# Azure Search output plugin for Fluentd\r\n\r\nfluent-plugin-azuresearch is a fluent plugin to output to Azure Search\r\n\r\n## Installation\r\n\r\n    $ gem install fluent-plugin-azuresearch\r\n\r\n## Configuration\r\n\r\n### Azure Search\r\n\r\nTo use Microsoft Azure Search, you must create an Azure Search service in the Azure Portal. Also you must have an index, persisted storage of documents to which fluent-plugin-azuresearch writes event stream out. Here are instructions:\r\n\r\n * [Create a service](https://azure.microsoft.com/en-us/documentation/articles/search-create-service-portal/)\r\n * [Create an index](https://azure.microsoft.com/en-us/documentation/articles/search-what-is-an-index/)\r\n\r\n\r\n### Fluentd - fluent.conf\r\n\r\n    <match azuresearch.*>\r\n        @type azuresearch\r\n        endpoint   https://AZURE_SEARCH_ACCOUNT.search.windows.net\r\n        api_key    AZURE_SEARCH_API_KEY\r\n        search_index  messages\r\n        column_names id,user_name,message,tag,created_at\r\n        key_names postid,user,content,tag,posttime\r\n    </match>\r\n  \r\n * **endpoint (required)** - Azure Search service endpoint URI\r\n * **api\\_key (required)** - Azure Search API key\r\n * **search\\_index (required)** - Azure Search Index name to insert records\r\n * **column\\_names (required)** - Column names in a target Azure search index. Each column needs to be separated by a comma.\r\n * **key\\_names (optional)** - Default:nil. Key names in incomming record to insert. Each key needs to be separated by a comma. ${time} is placeholder for Time.at(time).strftime(\"%Y-%m-%dT%H:%M:%SZ\"), and ${tag} is placeholder for tag. By default, **key\\_names** is as same as **column\\_names**\r\n\r\n## Sample Configurations\r\n### Case1 - column_names is as same as key_names \r\n\r\nSuppose you have the following fluent.conf and azure search index schema:\r\n\r\n<u>fluent.conf</u>\r\n\r\n    <match azuresearch.*>\r\n        @type azuresearch\r\n        endpoint   https://yoichidemo.search.windows.net\r\n        api_key    2XX3D2456052A9AD21E54CB03C3ABF6A(dummy)\r\n        search_index  messages\r\n        column_names id,user_name,message,created_at\r\n    </match>\r\n\r\n<u>Azure Search Schema: messages</u>\r\n\r\n    {\r\n        \"name\": \"messages\",\r\n        \"fields\": [\r\n            { \"name\":\"id\", \"type\":\"Edm.String\", \"key\": true, \"searchable\": false },\r\n            { \"name\":\"user_name\", \"type\":\"Edm.String\" },\r\n            { \"name\":\"message\", \"type\":\"Edm.String\", \"filterable\":false, \"sortable\":false, \"facetable\":false, \"analyzer\":\"en.lucene\" },\r\n            { \"name\":\"created_at\", \"type\":\"Edm.DateTimeOffset\", \"facetable\":false}\r\n        ]\r\n    }\r\n\r\nThe plugin will write event stream out to Azure Ssearch like this:\r\n\r\n<u>Input event stream</u>\r\n\r\n    { \"id\": \"1\", \"user_name\": \"taylorswift13\", \"message\":\"post by taylorswift13\", \"created_at\":\"2016-01-29T00:00:00Z\" },\r\n    { \"id\": \"2\", \"user_name\": \"katyperry\", \"message\":\"post by katyperry\", \"created_at\":\"2016-01-30T00:00:00Z\" },\r\n    { \"id\": \"3\", \"user_name\": \"ladygaga\", \"message\":\"post by ladygaga\", \"created_at\":\"2016-01-31T00:00:00Z\" }\r\n\r\n\r\n<u>Search results</u>\r\n\r\n    \"value\": [\r\n        { \"@search.score\": 1, \"id\": \"1\", \"user_name\": \"taylorswift13\", \"message\": \"post by taylorswift13\", \"created_at\": \"2016-01-29T00:00:00Z\" },\r\n        { \"@search.score\": 1, \"id\": \"2\", \"user_name\": \"katyperry\", \"message\": \"post by katyperry\", \"created_at\": \"2016-01-30T00:00:00Z\" },\r\n        { \"@search.score\": 1, \"id\": \"3\", \"user_name\": \"ladygaga\", \"message\": \"post by ladygaga\", \"created_at\": \"2016-01-31T00:00:00Z\" }\r\n    ]\r\n\r\n\r\n### Case2 - column_names is NOT as same as key_names\r\n\r\nSuppose you have the following fluent.conf and azure search index schema:\r\n\r\n<u>fluent.conf</u>\r\n\r\n    <match azuresearch.*>\r\n        @type azuresearch\r\n        endpoint   https://yoichidemo.search.windows.net\r\n        api_key    2XX3D2456052A9AD21E54CB03C3ABF6A(dummy)\r\n        search_index  messages\r\n        column_names id,user_name,message,created_at\r\n        key_names postid,user,content,posttime\r\n    </match>\r\n\r\n<u>Azure Search Schema: messages</u>\r\n\r\n    {\r\n        \"name\": \"messages\",\r\n        \"fields\": [\r\n            { \"name\":\"id\", \"type\":\"Edm.String\", \"key\": true, \"searchable\": false },\r\n            { \"name\":\"user_name\", \"type\":\"Edm.String\" },\r\n            { \"name\":\"message\", \"type\":\"Edm.String\", \"filterable\":false, \"sortable\":false, \"facetable\":false, \"analyzer\":\"en.lucene\" },\r\n            { \"name\":\"created_at\", \"type\":\"Edm.DateTimeOffset\", \"facetable\":false}\r\n        ]\r\n    }\r\n\r\nThe plugin will write event stream out to Azure Ssearch like this:\r\n\r\n<u>Input event stream</u>\r\n\r\n    { \"postid\": \"1\", \"user\": \"taylorswift13\", \"content\":\"post by taylorswift13\", \"posttime\":\"2016-01-29T00:00:00Z\" },\r\n    { \"postid\": \"2\", \"user\": \"katyperry\", \"content\":\"post by katyperry\", \"posttime\":\"2016-01-30T00:00:00Z\" },\r\n    { \"postid\": \"3\", \"user\": \"ladygaga\", \"content\":\"post by ladygaga\", \"posttime\":\"2016-01-31T00:00:00Z\" }\r\n\r\n\r\n<u>Search results</u>\r\n\r\n    \"value\": [\r\n        { \"@search.score\": 1, \"id\": \"1\", \"user_name\": \"taylorswift13\", \"message\": \"post by taylorswift13\", \"created_at\": \"2016-01-29T00:00:00Z\" },\r\n        { \"@search.score\": 1, \"id\": \"2\", \"user_name\": \"katyperry\", \"message\": \"post by katyperry\", \"created_at\": \"2016-01-30T00:00:00Z\" },\r\n        { \"@search.score\": 1, \"id\": \"3\", \"user_name\": \"ladygaga\", \"message\": \"post by ladygaga\", \"created_at\": \"2016-01-31T00:00:00Z\" }\r\n    ]\r\n\r\n\r\n### Case3 - column_names is NOT as same as key_names, Plus, key_names includes ${time} and ${tag}\r\n\r\n<u>fluent.conf</u>\r\n\r\n    <match azuresearch.*>\r\n        @type azuresearch\r\n        endpoint   https://yoichidemo.search.windows.net\r\n        api_key    2XX3D2456052A9AD21E54CB03C3ABF6A(dummy)\r\n        search_index  messages\r\n        column_names id,user_name,message,tag,created_at\r\n        key_names postid,user,content,${tag},${time}\r\n    </match>\r\n\r\n<u>Azure Search Schema: messages</u>\r\n\r\n    {\r\n        \"name\": \"messages\",\r\n        \"fields\": [\r\n            { \"name\":\"id\", \"type\":\"Edm.String\", \"key\": true, \"searchable\": false },\r\n            { \"name\":\"user_name\", \"type\":\"Edm.String\" },\r\n            { \"name\":\"message\", \"type\":\"Edm.String\", \"filterable\":false, \"sortable\":false, \"facetable\":false, \"analyzer\":\"en.lucene\" },\r\n            { \"name\":\"created_at\", \"type\":\"Edm.DateTimeOffset\", \"facetable\":false}\r\n        ]\r\n    }\r\n\r\nThe plugin will write event stream out to Azure Ssearch like this:\r\n\r\n<u>Input event stream</u>\r\n\r\n    { \"id\": \"1\", \"user_name\": \"taylorswift13\", \"message\":\"post by taylorswift13\" },\r\n    { \"id\": \"2\", \"user_name\": \"katyperry\", \"message\":\"post by katyperry\" },\r\n    { \"id\": \"3\", \"user_name\": \"ladygaga\", \"message\":\"post by ladygaga\" }\r\n\r\n<u>Search results</u>\r\n\r\n    \"value\": [\r\n        { \"@search.score\": 1, \"id\": \"1\", \"user_name\": \"taylorswift13\", \"message\": \"post by taylorswift13\", \"tag\": \"azuresearch.msg\", \"created_at\": \"2016-01-31T21:03:41Z\" },\r\n        { \"@search.score\": 1, \"id\": \"2\", \"user_name\": \"katyperry\", \"message\": \"post by katyperry\", \"tag\": \"azuresearch.msg\", \"created_at\": \"2016-01-31T21:03:41Z\" },\r\n        { \"@search.score\": 1, \"id\": \"3\", \"user_name\": \"ladygaga\", \"message\": \"post by ladygaga\", \"tag\": \"azuresearch.msg\", \"created_at\": \"2016-01-31T21:03:41Z\" }\r\n    ]\r\n[note] the value of created_at above is the time when fluentd actually recieves its corresponding input event.\r\n\r\n\r\n## Tests\r\n### Running test code\r\n    $ git clone https://github.com/yokawasa/fluent-plugin-azuresearch.git\r\n    $ cd fluent-plugin-azuresearch\r\n    \r\n    # edit CONFIG params of test/plugin/test_azuresearch.rb \r\n    $ vi test/plugin/test_azuresearch.rb\r\n    \r\n    # run test \r\n    $ rake test\r\n\r\n### Creating package, running and testing locally \r\n    $ rake build\r\n    $ rake install:local\r\n     \r\n    # running fluentd with your fluent.conf\r\n    $ fluentd -c fluent.conf -vv &\r\n     \r\n    # send test input event to test plugin using fluent-cat\r\n    $ echo ' { \"postid\": \"100\", \"user\": \"ladygaga\", \"content\":\"post by ladygaga\"}' | fluent-cat azuresearch.msg\r\n\r\nPlease don't forget that you need forward input configuration to receive the message from fluent-cat\r\n\r\n    <source>\r\n        @type forward\r\n    </source>\r\n\r\n\r\n## TODOs\r\n * Input validation for Azure Search - check total size of columns to add \r\n\r\n## Change log\r\n* [Changelog](ChangeLog.md)\r\n\r\n## Links\r\n\r\n* http://yokawasa.github.io/fluent-plugin-azuresearch\r\n* https://rubygems.org/gems/fluent-plugin-azuresearch\r\n\r\n## Contributing\r\n\r\nBug reports and pull requests are welcome on GitHub at https://github.com/yokawasa/fluent-plugin-azuresearch.\r\n\r\n## Copyright\r\n\r\n<table>\r\n  <tr>\r\n    <td>Copyright</td><td>Copyright (c) 2016- Yoichi Kawasaki</td>\r\n  </tr>\r\n  <tr>\r\n    <td>License</td><td>Apache License, Version 2.0</td>\r\n  </tr>\r\n</table>\r\n\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}